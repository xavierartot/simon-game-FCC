'use strict';

//https://toddmotto.com/mastering-the-module-pattern/#revealing-module-pattern
var Simon = function () {
  var data = {
    caseCoche: document.querySelector('.caseCoche'),
    start: document.querySelector('.text__start'),
    startActive: document.querySelector('.text__btn'), //start btn
    green: document.querySelector('.shape__color-green'),
    red: document.querySelector('.shape__color-red'),
    blue: document.querySelector('.shape__color-blue'),
    yellow: document.querySelector('.shape__color-yellow'),
    shape: document.querySelectorAll('.shape__color'),
    countBox: document.querySelector('.text__box'), //count
    arraySimon: [3, 2, 3, 1, 4, 1, 4]
  },
      dataGame = {
    1: { color: 'green', num: 1, sound: 'http://artot.net/sounds/other1.mp3' },
    2: { color: 'red', num: 2, sound: 'http://artot.net/sounds/other2.mp3' },
    3: { color: 'blue', num: 3, sound: 'http://artot.net/sounds/play.mp3' },
    4: { color: 'yellow', num: 4, sound: 'http://artot.net/sounds/soft.mp3' }
  },
      errorSound = 'https://s3.amazonaws.com/freecodecamp/simonSound1.mp3',
      //from https://www.freecodecamp.com/challenges/build-a-simon-game
  color = '',
      random = '',
      randomTemp = '';

  // private
  var _playSound = function _playSound(sound) {
    new Audio(sound).play();
  };

  // the ai start
  var _turn = function _turn(t) {
    if (data.caseCoche.checked !== false) {
      alert('turn on the game');
      return false;
    }
    return t % 2 === 0 ? console.log(1) : console.log(0);
  };

  var error = function error(time) {
    return setTimeout(function () {
      _playSound(errorSound);
      data.countBox.textContent = 'err';
      data.countBox.classList.add('error');
      _ai();
    }, time); //1s
  };

  var opponent = function opponent() {
    data.arraySimon.push(dataGame[randomTemp]);
    for (var i = 0, l = data.arraySimon.length; i < l; i++) {
      var cur = data.arraySimon[i],
          prev = data.arraySimon[i - 1];
      //console.log(cur);
    }
  };

  var addOneStep = function addOneStep() {
    var d = data.arraySimon;

    randomTemp = Random();
    d.push(dataGame[randomTemp]);

    data.countBox.textContent = d.length;

    setTimeout(function () {

      //add color with randomTemp 
      for (var prop in data) {
        if (data.hasOwnProperty(prop)) {
          var _d = data[prop];
          if (prop === dataGame[randomTemp].color) {
            _d.classList.add('active');
          }
        }
      }
      //add sound with randomTemp 
      _playSound(dataGame[randomTemp].sound);
      console.log(dataGame[randomTemp].sound);
    }, 1000); //1s
  };

  var _ai = function _ai() {
    var d = data.arraySimon,
        j = 0,
        anim = void 0;
    if (d.length === 0) {
      //add a step
      setTimeout(function () {
        addOneStep();
      }, 1e3); //1s
    } else {
      //if the array is not empty loop through every seconds
      //then, add a step
      if (d.length > 0 && j <= d.length) {
        console.log(d);
        anim = setInterval(function () {
          if (j >= d.length) {
            clearInterval(anim);
            //add one step
            setTimeout(function () {
              //return addOneStep() 
            }, 1e3); //1s
          } else {
            removeActive();
            console.log(d[j]);
            console.log(dataGame[d[j]].color);
            console.log(dataGame[d[j]].sound);

            for (var prop in data) {
              if (data.hasOwnProperty(prop)) {
                var da = data[prop];
                if (prop === dataGame[d[j]].color) {
                  da.classList.add('active');
                }
              }
            }
            //add sound with randomTemp 
            _playSound(dataGame[d[j]].sound);
            console.log(dataGame[d[j]].sound);
            //for (let i = 0, l = d.length; i < l; i++) {
            //let current = d[i]
            //console.log(current);
            //for (let prop in dataGame){
            //if (dataGame.hasOwnProperty(prop)) {
            //if (dataGame[prop].num === current) {
            //console.log(dataGame[prop].color);
            //console.log(dataGame[prop].sound);
            //}

            //}
            //}
            //}
          }
          j++;
        }, 1e3); //1s
      }
    }
  };

  //random between 1 and 4
  var Random = function Random() {
    random = Math.floor(Math.random() * 4) + 1;
    return random;
  };

  var removeActiveClass = function removeActiveClass() {
    var col = document.querySelectorAll('.shape__color');
    for (var i = 0; i < col.length; i++) {
      col[i].classList.remove('active');
    }
  };

  // private
  // dataGame = sound, num, color
  var _start = function _start() {
    data.caseCoche.checked = false;
    //checked
    data.caseCoche.addEventListener('change', function () {
      //console.log(this.checked);
      if (this.checked) {
        //if this.checked is true
        return true;
      } else {
        //empty arraySimon 
        //data.arraySimon = []

        data.startActive.classList.remove('active');

        //remove class error
        data.countBox.classList.remove('error');
        data.countBox.textContent = '';
        //remove class active
        removeActiveClass();

        return true;
      }
    });
    data.start.addEventListener('click', function (e) {
      if (data.caseCoche.checked === true) {
        //start the ai
        _ai();
        //start btn
        data.startActive.classList.add('active');
        //remove .error
        data.countBox.classList.remove('error');
      } //end checked true
      e.preventDefault();
    }); // end click on start
    return false;
  };

  var shapeClick = function shapeClick() {
    for (var i = 0, l = data.shape.length; i < l; i++) {
      var current = data.shape[i],
          prev = data.shape[i - 1];
      current.addEventListener('click', function (e) {
        var $this = this.textContent;
        this.classList.add('active');
        _playSound(dataGame[$this].sound);
        e.preventDefault();
      });
    }
  };

  var removeActive = function removeActive() {
    for (var i = 0, l = data.shape.length; i < l; i++) {
      var current = data.shape[i],
          prev = data.shape[i - 1];
      if (current.classList.contains('active') === true) {
        current.classList.remove('active');
      }
    }
  };

  //main
  var main = function main() {

    shapeClick();
    _start();
    removeActive();
    return true;
  };

  return {
    main: main
  };
}();
Simon.main();
//Simon.anotherMethod ()
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJTaW1vbiIsImRhdGEiLCJjYXNlQ29jaGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzdGFydCIsInN0YXJ0QWN0aXZlIiwiZ3JlZW4iLCJyZWQiLCJibHVlIiwieWVsbG93Iiwic2hhcGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY291bnRCb3giLCJhcnJheVNpbW9uIiwiZGF0YUdhbWUiLCJjb2xvciIsIm51bSIsInNvdW5kIiwiZXJyb3JTb3VuZCIsInJhbmRvbSIsInJhbmRvbVRlbXAiLCJfcGxheVNvdW5kIiwiQXVkaW8iLCJwbGF5IiwiX3R1cm4iLCJ0IiwiY2hlY2tlZCIsImFsZXJ0IiwiY29uc29sZSIsImxvZyIsImVycm9yIiwidGltZSIsInNldFRpbWVvdXQiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsImFkZCIsIl9haSIsIm9wcG9uZW50IiwicHVzaCIsImkiLCJsIiwibGVuZ3RoIiwiY3VyIiwicHJldiIsImFkZE9uZVN0ZXAiLCJkIiwiUmFuZG9tIiwicHJvcCIsImhhc093blByb3BlcnR5IiwiaiIsImFuaW0iLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJyZW1vdmVBY3RpdmUiLCJkYSIsIk1hdGgiLCJmbG9vciIsInJlbW92ZUFjdGl2ZUNsYXNzIiwiY29sIiwicmVtb3ZlIiwiX3N0YXJ0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNoYXBlQ2xpY2siLCJjdXJyZW50IiwiJHRoaXMiLCJjb250YWlucyIsIm1haW4iXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQSxJQUFJQSxRQUFVLFlBQU07QUFDbEIsTUFBSUMsT0FBTztBQUNUQyxlQUFxQkMsU0FBU0MsYUFBVCxDQUF1QixZQUF2QixDQURaO0FBRVRDLFdBQXFCRixTQUFTQyxhQUFULENBQXVCLGNBQXZCLENBRlo7QUFHVEUsaUJBQXFCSCxTQUFTQyxhQUFULENBQXVCLFlBQXZCLENBSFosRUFHa0Q7QUFDM0RHLFdBQXFCSixTQUFTQyxhQUFULENBQXVCLHFCQUF2QixDQUpaO0FBS1RJLFNBQXFCTCxTQUFTQyxhQUFULENBQXVCLG1CQUF2QixDQUxaO0FBTVRLLFVBQXFCTixTQUFTQyxhQUFULENBQXVCLG9CQUF2QixDQU5aO0FBT1RNLFlBQXFCUCxTQUFTQyxhQUFULENBQXVCLHNCQUF2QixDQVBaO0FBUVRPLFdBQXFCUixTQUFTUyxnQkFBVCxDQUEwQixlQUExQixDQVJaO0FBU1RDLGNBQXFCVixTQUFTQyxhQUFULENBQXVCLFlBQXZCLENBVFosRUFTaUQ7QUFDMURVLGdCQUFxQixDQUFDLENBQUQsRUFBRyxDQUFILEVBQUssQ0FBTCxFQUFPLENBQVAsRUFBUyxDQUFULEVBQVcsQ0FBWCxFQUFhLENBQWI7QUFWWixHQUFYO0FBQUEsTUFZQUMsV0FBVztBQUNULE9BQUksRUFBQ0MsT0FBTyxPQUFSLEVBQW1CQyxLQUFPLENBQTFCLEVBQTZCQyxPQUFRLG9DQUFyQyxFQURLO0FBRVQsT0FBSSxFQUFDRixPQUFPLEtBQVIsRUFBbUJDLEtBQU8sQ0FBMUIsRUFBNkJDLE9BQVEsb0NBQXJDLEVBRks7QUFHVCxPQUFJLEVBQUNGLE9BQU8sTUFBUixFQUFtQkMsS0FBTyxDQUExQixFQUE2QkMsT0FBUSxrQ0FBckMsRUFISztBQUlULE9BQUksRUFBQ0YsT0FBTyxRQUFSLEVBQW1CQyxLQUFPLENBQTFCLEVBQTZCQyxPQUFRLGtDQUFyQztBQUpLLEdBWlg7QUFBQSxNQWtCQUMsYUFBYSx1REFsQmI7QUFBQSxNQWtCc0U7QUFDdEVILFVBQWMsRUFuQmQ7QUFBQSxNQW9CQUksU0FBYyxFQXBCZDtBQUFBLE1BcUJBQyxhQUFjLEVBckJkOztBQXVCQTtBQUNBLE1BQUlDLGFBQWEsU0FBYkEsVUFBYSxDQUFDSixLQUFELEVBQVc7QUFDMUIsUUFBSUssS0FBSixDQUFVTCxLQUFWLEVBQWlCTSxJQUFqQjtBQUNELEdBRkQ7O0FBSUE7QUFDQSxNQUFJQyxRQUFRLFNBQVJBLEtBQVEsQ0FBQ0MsQ0FBRCxFQUFPO0FBQ2pCLFFBQUl6QixLQUFLQyxTQUFMLENBQWV5QixPQUFmLEtBQTJCLEtBQS9CLEVBQXNDO0FBQ3BDQyxZQUFNLGtCQUFOO0FBQ0EsYUFBTyxLQUFQO0FBQ0Q7QUFDRCxXQUFPRixJQUFJLENBQUosS0FBVSxDQUFWLEdBQWNHLFFBQVFDLEdBQVIsQ0FBWSxDQUFaLENBQWQsR0FBK0JELFFBQVFDLEdBQVIsQ0FBWSxDQUFaLENBQXRDO0FBQ0QsR0FORDs7QUFRQSxNQUFJQyxRQUFRLFNBQVJBLEtBQVEsQ0FBQ0MsSUFBRCxFQUFVO0FBQ3BCLFdBQU9DLFdBQVcsWUFBWTtBQUM1QlgsaUJBQVdILFVBQVg7QUFDQWxCLFdBQUtZLFFBQUwsQ0FBY3FCLFdBQWQsR0FBNEIsS0FBNUI7QUFDQWpDLFdBQUtZLFFBQUwsQ0FBY3NCLFNBQWQsQ0FBd0JDLEdBQXhCLENBQTRCLE9BQTVCO0FBQ0FDO0FBQ0QsS0FMTSxFQUtKTCxJQUxJLENBQVAsQ0FEb0IsQ0FNWDtBQUNWLEdBUEQ7O0FBU0EsTUFBSU0sV0FBVyxTQUFYQSxRQUFXLEdBQU07QUFDbkJyQyxTQUFLYSxVQUFMLENBQWdCeUIsSUFBaEIsQ0FBc0J4QixTQUFTTSxVQUFULENBQXRCO0FBQ0EsU0FBSyxJQUFJbUIsSUFBSSxDQUFSLEVBQVdDLElBQUl4QyxLQUFLYSxVQUFMLENBQWdCNEIsTUFBcEMsRUFBNENGLElBQUlDLENBQWhELEVBQW1ERCxHQUFuRCxFQUF3RDtBQUN0RCxVQUFJRyxNQUFLMUMsS0FBS2EsVUFBTCxDQUFnQjBCLENBQWhCLENBQVQ7QUFBQSxVQUE2QkksT0FBTzNDLEtBQUthLFVBQUwsQ0FBZ0IwQixJQUFFLENBQWxCLENBQXBDO0FBQ0E7QUFDRDtBQUNGLEdBTkQ7O0FBUUEsTUFBSUssYUFBYSxTQUFiQSxVQUFhLEdBQU07QUFDckIsUUFBSUMsSUFBSTdDLEtBQUthLFVBQWI7O0FBRUFPLGlCQUFhMEIsUUFBYjtBQUNBRCxNQUFFUCxJQUFGLENBQVF4QixTQUFTTSxVQUFULENBQVI7O0FBRUFwQixTQUFLWSxRQUFMLENBQWNxQixXQUFkLEdBQTRCWSxFQUFFSixNQUE5Qjs7QUFFQVQsZUFBVyxZQUFZOztBQUVyQjtBQUNBLFdBQUssSUFBSWUsSUFBVCxJQUFpQi9DLElBQWpCLEVBQXNCO0FBQ3BCLFlBQUlBLEtBQUtnRCxjQUFMLENBQW9CRCxJQUFwQixDQUFKLEVBQStCO0FBQzdCLGNBQUlGLEtBQUc3QyxLQUFLK0MsSUFBTCxDQUFQO0FBQ0EsY0FBSUEsU0FBU2pDLFNBQVNNLFVBQVQsRUFBcUJMLEtBQWxDLEVBQXlDO0FBQ3ZDOEIsZUFBRVgsU0FBRixDQUFZQyxHQUFaLENBQWdCLFFBQWhCO0FBQ0Q7QUFDRjtBQUNGO0FBQ0Q7QUFDQWQsaUJBQVdQLFNBQVNNLFVBQVQsRUFBcUJILEtBQWhDO0FBQ0FXLGNBQVFDLEdBQVIsQ0FBWWYsU0FBU00sVUFBVCxFQUFxQkgsS0FBakM7QUFFRCxLQWZELEVBZUcsSUFmSCxFQVJxQixDQXVCWjtBQUNWLEdBeEJEOztBQTBCQSxNQUFJbUIsTUFBTSxTQUFOQSxHQUFNLEdBQU07QUFDZCxRQUFJUyxJQUFJN0MsS0FBS2EsVUFBYjtBQUFBLFFBQXlCb0MsSUFBRSxDQUEzQjtBQUFBLFFBQThCQyxhQUE5QjtBQUNBLFFBQUlMLEVBQUVKLE1BQUYsS0FBYSxDQUFqQixFQUFvQjtBQUNsQjtBQUNBVCxpQkFBVyxZQUFZO0FBQ3JCWTtBQUNELE9BRkQsRUFFRyxHQUZILEVBRmtCLENBSVY7QUFDVCxLQUxELE1BS007QUFDSjtBQUNBO0FBQ0EsVUFBSUMsRUFBRUosTUFBRixHQUFXLENBQVgsSUFBZ0JRLEtBQUtKLEVBQUVKLE1BQTNCLEVBQW1DO0FBQ2pDYixnQkFBUUMsR0FBUixDQUFZZ0IsQ0FBWjtBQUNBSyxlQUFPQyxZQUFZLFlBQVk7QUFDN0IsY0FBSUYsS0FBS0osRUFBRUosTUFBWCxFQUFvQjtBQUNsQlcsMEJBQWNGLElBQWQ7QUFDQTtBQUNBbEIsdUJBQVcsWUFBWTtBQUNyQjtBQUNELGFBRkQsRUFFRyxHQUZILEVBSGtCLENBS1Y7QUFDVCxXQU5ELE1BTU07QUFDSnFCO0FBQ0F6QixvQkFBUUMsR0FBUixDQUFZZ0IsRUFBRUksQ0FBRixDQUFaO0FBQ0FyQixvQkFBUUMsR0FBUixDQUFZZixTQUFTK0IsRUFBRUksQ0FBRixDQUFULEVBQWVsQyxLQUEzQjtBQUNBYSxvQkFBUUMsR0FBUixDQUFZZixTQUFTK0IsRUFBRUksQ0FBRixDQUFULEVBQWVoQyxLQUEzQjs7QUFFQSxpQkFBSyxJQUFJOEIsSUFBVCxJQUFpQi9DLElBQWpCLEVBQXNCO0FBQ3BCLGtCQUFJQSxLQUFLZ0QsY0FBTCxDQUFvQkQsSUFBcEIsQ0FBSixFQUErQjtBQUM3QixvQkFBSU8sS0FBSXRELEtBQUsrQyxJQUFMLENBQVI7QUFDQSxvQkFBSUEsU0FBU2pDLFNBQVMrQixFQUFFSSxDQUFGLENBQVQsRUFBZWxDLEtBQTVCLEVBQW1DO0FBQ2pDdUMscUJBQUdwQixTQUFILENBQWFDLEdBQWIsQ0FBaUIsUUFBakI7QUFDRDtBQUNGO0FBQ0Y7QUFDRDtBQUNBZCx1QkFBV1AsU0FBUytCLEVBQUVJLENBQUYsQ0FBVCxFQUFlaEMsS0FBMUI7QUFDQVcsb0JBQVFDLEdBQVIsQ0FBWWYsU0FBUytCLEVBQUVJLENBQUYsQ0FBVCxFQUFlaEMsS0FBM0I7QUFDQTtBQUNFO0FBQ0E7QUFDQTtBQUNFO0FBQ0U7QUFDRTtBQUNBO0FBQ0Y7O0FBRUY7QUFDRjtBQUNGO0FBQ0Q7QUFDRGdDO0FBQ0QsU0F2Q00sRUF1Q0osR0F2Q0ksQ0FBUCxDQUZpQyxDQXlDekI7QUFDVDtBQUNGO0FBQ0YsR0F0REQ7O0FBd0RBO0FBQ0EsTUFBSUgsU0FBUyxTQUFUQSxNQUFTLEdBQU07QUFDakIzQixhQUFVb0MsS0FBS0MsS0FBTCxDQUFXRCxLQUFLcEMsTUFBTCxLQUFnQixDQUEzQixJQUFnQyxDQUExQztBQUNBLFdBQU9BLE1BQVA7QUFDRCxHQUhEOztBQUtBLE1BQUlzQyxvQkFBb0IsU0FBcEJBLGlCQUFvQixHQUFNO0FBQzVCLFFBQUlDLE1BQU14RCxTQUFTUyxnQkFBVCxDQUEwQixlQUExQixDQUFWO0FBQ0EsU0FBSyxJQUFJNEIsSUFBSSxDQUFiLEVBQWdCQSxJQUFJbUIsSUFBSWpCLE1BQXhCLEVBQWdDRixHQUFoQyxFQUFxQztBQUNuQ21CLFVBQUluQixDQUFKLEVBQU9MLFNBQVAsQ0FBaUJ5QixNQUFqQixDQUF3QixRQUF4QjtBQUNEO0FBQ0YsR0FMRDs7QUFPQTtBQUNBO0FBQ0EsTUFBSUMsU0FBUyxTQUFUQSxNQUFTLEdBQU07QUFDakI1RCxTQUFLQyxTQUFMLENBQWV5QixPQUFmLEdBQXlCLEtBQXpCO0FBQ0E7QUFDQTFCLFNBQUtDLFNBQUwsQ0FBZTRELGdCQUFmLENBQWdDLFFBQWhDLEVBQXlDLFlBQVc7QUFDbEQ7QUFDQSxVQUFJLEtBQUtuQyxPQUFULEVBQWtCO0FBQUM7QUFDakIsZUFBTyxJQUFQO0FBQ0QsT0FGRCxNQUVNO0FBQ0o7QUFDQTs7QUFFQTFCLGFBQUtLLFdBQUwsQ0FBaUI2QixTQUFqQixDQUEyQnlCLE1BQTNCLENBQWtDLFFBQWxDOztBQUVBO0FBQ0EzRCxhQUFLWSxRQUFMLENBQWNzQixTQUFkLENBQXdCeUIsTUFBeEIsQ0FBK0IsT0FBL0I7QUFDQTNELGFBQUtZLFFBQUwsQ0FBY3FCLFdBQWQsR0FBNEIsRUFBNUI7QUFDQTtBQUNBd0I7O0FBRUEsZUFBTyxJQUFQO0FBQ0Q7QUFFRixLQW5CRDtBQW9CQXpELFNBQUtJLEtBQUwsQ0FBV3lELGdCQUFYLENBQTRCLE9BQTVCLEVBQXFDLFVBQVNDLENBQVQsRUFBWTtBQUMvQyxVQUFJOUQsS0FBS0MsU0FBTCxDQUFleUIsT0FBZixLQUEyQixJQUEvQixFQUFxQztBQUNuQztBQUNBVTtBQUNBO0FBQ0FwQyxhQUFLSyxXQUFMLENBQWlCNkIsU0FBakIsQ0FBMkJDLEdBQTNCLENBQStCLFFBQS9CO0FBQ0E7QUFDQW5DLGFBQUtZLFFBQUwsQ0FBY3NCLFNBQWQsQ0FBd0J5QixNQUF4QixDQUErQixPQUEvQjtBQUNELE9BUjhDLENBUTdDO0FBQ0ZHLFFBQUVDLGNBQUY7QUFDRCxLQVZELEVBdkJpQixDQWlDYjtBQUNKLFdBQU8sS0FBUDtBQUNELEdBbkNEOztBQXFDQSxNQUFJQyxhQUFhLFNBQWJBLFVBQWEsR0FBTTtBQUNyQixTQUFLLElBQUl6QixJQUFJLENBQVIsRUFBV0MsSUFBSXhDLEtBQUtVLEtBQUwsQ0FBVytCLE1BQS9CLEVBQXVDRixJQUFJQyxDQUEzQyxFQUE4Q0QsR0FBOUMsRUFBbUQ7QUFDakQsVUFBSTBCLFVBQVVqRSxLQUFLVSxLQUFMLENBQVc2QixDQUFYLENBQWQ7QUFBQSxVQUE2QkksT0FBTzNDLEtBQUtVLEtBQUwsQ0FBVzZCLElBQUUsQ0FBYixDQUFwQztBQUNBMEIsY0FBUUosZ0JBQVIsQ0FBeUIsT0FBekIsRUFBa0MsVUFBU0MsQ0FBVCxFQUFZO0FBQzVDLFlBQUlJLFFBQVEsS0FBS2pDLFdBQWpCO0FBQ0EsYUFBS0MsU0FBTCxDQUFlQyxHQUFmLENBQW1CLFFBQW5CO0FBQ0FkLG1CQUFXUCxTQUFTb0QsS0FBVCxFQUFnQmpELEtBQTNCO0FBQ0E2QyxVQUFFQyxjQUFGO0FBQ0QsT0FMRDtBQU1EO0FBR0YsR0FaRDs7QUFjQSxNQUFJVixlQUFlLFNBQWZBLFlBQWUsR0FBTTtBQUN2QixTQUFLLElBQUlkLElBQUksQ0FBUixFQUFXQyxJQUFJeEMsS0FBS1UsS0FBTCxDQUFXK0IsTUFBL0IsRUFBdUNGLElBQUlDLENBQTNDLEVBQThDRCxHQUE5QyxFQUFtRDtBQUNqRCxVQUFJMEIsVUFBVWpFLEtBQUtVLEtBQUwsQ0FBVzZCLENBQVgsQ0FBZDtBQUFBLFVBQTZCSSxPQUFPM0MsS0FBS1UsS0FBTCxDQUFXNkIsSUFBRSxDQUFiLENBQXBDO0FBQ0EsVUFBSTBCLFFBQVEvQixTQUFSLENBQWtCaUMsUUFBbEIsQ0FBMkIsUUFBM0IsTUFBeUMsSUFBN0MsRUFBbUQ7QUFDakRGLGdCQUFRL0IsU0FBUixDQUFrQnlCLE1BQWxCLENBQXlCLFFBQXpCO0FBQ0Q7QUFDRjtBQUNGLEdBUEQ7O0FBU0E7QUFDQSxNQUFJUyxPQUFRLFNBQVJBLElBQVEsR0FBTTs7QUFFaEJKO0FBQ0FKO0FBQ0FQO0FBQ0EsV0FBTyxJQUFQO0FBQ0QsR0FORDs7QUFRQSxTQUFPO0FBQ0xlLFVBQU9BO0FBREYsR0FBUDtBQUlELENBak9XLEVBQVo7QUFrT0FyRSxNQUFNcUUsSUFBTjtBQUNBIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vaHR0cHM6Ly90b2RkbW90dG8uY29tL21hc3RlcmluZy10aGUtbW9kdWxlLXBhdHRlcm4vI3JldmVhbGluZy1tb2R1bGUtcGF0dGVyblxubGV0IFNpbW9uID0gKCAoKSA9PiB7XG4gIGxldCBkYXRhID0geyBcbiAgICBjYXNlQ29jaGUgICAgICAgICAgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FzZUNvY2hlJyksXG4gICAgc3RhcnQgICAgICAgICAgICAgIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRleHRfX3N0YXJ0JyksXG4gICAgc3RhcnRBY3RpdmUgICAgICAgIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRleHRfX2J0bicpLCAvL3N0YXJ0IGJ0blxuICAgIGdyZWVuICAgICAgICAgICAgICA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGFwZV9fY29sb3ItZ3JlZW4nKSxcbiAgICByZWQgICAgICAgICAgICAgICAgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hhcGVfX2NvbG9yLXJlZCcpLFxuICAgIGJsdWUgICAgICAgICAgICAgICA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGFwZV9fY29sb3ItYmx1ZScpLFxuICAgIHllbGxvdyAgICAgICAgICAgICA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGFwZV9fY29sb3IteWVsbG93JyksXG4gICAgc2hhcGUgICAgICAgICAgICAgIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNoYXBlX19jb2xvcicpLFxuICAgIGNvdW50Qm94ICAgICAgICAgICA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZXh0X19ib3gnKSwvL2NvdW50XG4gICAgYXJyYXlTaW1vbiAgICAgICAgIDogWzMsMiwzLDEsNCwxLDRdXG4gIH0sXG4gIGRhdGFHYW1lID0ge1xuICAgIDEgOiB7Y29sb3IgOidncmVlbicgICwgbnVtIDogIDEsIHNvdW5kOiAgJ2h0dHA6Ly9hcnRvdC5uZXQvc291bmRzL290aGVyMS5tcDMnICAgIH0sXG4gICAgMiA6IHtjb2xvciA6J3JlZCcgICAgLCBudW0gOiAgMiwgc291bmQ6ICAnaHR0cDovL2FydG90Lm5ldC9zb3VuZHMvb3RoZXIyLm1wMycgICAgfSxcbiAgICAzIDoge2NvbG9yIDonYmx1ZScgICAsIG51bSA6ICAzLCBzb3VuZDogICdodHRwOi8vYXJ0b3QubmV0L3NvdW5kcy9wbGF5Lm1wMycgICAgICB9LFxuICAgIDQgOiB7Y29sb3IgOid5ZWxsb3cnICwgbnVtIDogIDQsIHNvdW5kOiAgJ2h0dHA6Ly9hcnRvdC5uZXQvc291bmRzL3NvZnQubXAzJyAgICAgIH1cbiAgfSxcbiAgZXJyb3JTb3VuZCA9ICdodHRwczovL3MzLmFtYXpvbmF3cy5jb20vZnJlZWNvZGVjYW1wL3NpbW9uU291bmQxLm1wMycsIC8vZnJvbSBodHRwczovL3d3dy5mcmVlY29kZWNhbXAuY29tL2NoYWxsZW5nZXMvYnVpbGQtYS1zaW1vbi1nYW1lXG4gIGNvbG9yICAgICAgID0gJycsXG4gIHJhbmRvbSAgICAgID0gJycsXG4gIHJhbmRvbVRlbXAgID0gJydcblxuICAvLyBwcml2YXRlXG4gIGxldCBfcGxheVNvdW5kID0gKHNvdW5kKSA9PiB7XG4gICAgbmV3IEF1ZGlvKHNvdW5kKS5wbGF5KClcbiAgfVxuXG4gIC8vIHRoZSBhaSBzdGFydFxuICBsZXQgX3R1cm4gPSAodCkgPT4ge1xuICAgIGlmIChkYXRhLmNhc2VDb2NoZS5jaGVja2VkICE9PSBmYWxzZSkge1xuICAgICAgYWxlcnQoJ3R1cm4gb24gdGhlIGdhbWUnKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIHJldHVybiB0ICUgMiA9PT0gMCA/IGNvbnNvbGUubG9nKDEpIDogY29uc29sZS5sb2coMClcbiAgfVxuXG4gIGxldCBlcnJvciA9ICh0aW1lKSA9PiB7XG4gICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgX3BsYXlTb3VuZChlcnJvclNvdW5kIClcbiAgICAgIGRhdGEuY291bnRCb3gudGV4dENvbnRlbnQgPSAnZXJyJ1xuICAgICAgZGF0YS5jb3VudEJveC5jbGFzc0xpc3QuYWRkKCdlcnJvcicpXG4gICAgICBfYWkoKVxuICAgIH0sIHRpbWUpOy8vMXNcbiAgfVxuXG4gIGxldCBvcHBvbmVudCA9ICgpID0+IHtcbiAgICBkYXRhLmFycmF5U2ltb24ucHVzaCggZGF0YUdhbWVbcmFuZG9tVGVtcF0gKVxuICAgIGZvciAobGV0IGkgPSAwLCBsID0gZGF0YS5hcnJheVNpbW9uLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgbGV0IGN1cj0gZGF0YS5hcnJheVNpbW9uW2ldLCBwcmV2ID0gZGF0YS5hcnJheVNpbW9uW2ktMV07XG4gICAgICAvL2NvbnNvbGUubG9nKGN1cik7XG4gICAgfVxuICB9XG5cbiAgbGV0IGFkZE9uZVN0ZXAgPSAoKSA9PiB7XG4gICAgbGV0IGQgPSBkYXRhLmFycmF5U2ltb24gXG5cbiAgICByYW5kb21UZW1wID0gUmFuZG9tKClcbiAgICBkLnB1c2goIGRhdGFHYW1lW3JhbmRvbVRlbXBdIClcblxuICAgIGRhdGEuY291bnRCb3gudGV4dENvbnRlbnQgPSBkLmxlbmd0aCBcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG4gICAgICAvL2FkZCBjb2xvciB3aXRoIHJhbmRvbVRlbXAgXG4gICAgICBmb3IgKGxldCBwcm9wIGluIGRhdGEpe1xuICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkge1xuICAgICAgICAgIGxldCBkID1kYXRhW3Byb3BdIFxuICAgICAgICAgIGlmIChwcm9wID09PSBkYXRhR2FtZVtyYW5kb21UZW1wXS5jb2xvcikge1xuICAgICAgICAgICAgZC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy9hZGQgc291bmQgd2l0aCByYW5kb21UZW1wIFxuICAgICAgX3BsYXlTb3VuZChkYXRhR2FtZVtyYW5kb21UZW1wXS5zb3VuZClcbiAgICAgIGNvbnNvbGUubG9nKGRhdGFHYW1lW3JhbmRvbVRlbXBdLnNvdW5kKTtcblxuICAgIH0sIDEwMDApOy8vMXNcbiAgfVxuICBcbiAgbGV0IF9haSA9ICgpID0+IHtcbiAgICBsZXQgZCA9IGRhdGEuYXJyYXlTaW1vbiwgaj0wLCBhbmltXG4gICAgaWYgKGQubGVuZ3RoID09PSAwKSB7XG4gICAgICAvL2FkZCBhIHN0ZXBcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBhZGRPbmVTdGVwKCkgXG4gICAgICB9LCAxZTMpOy8vMXNcbiAgICB9IGVsc2V7XG4gICAgICAvL2lmIHRoZSBhcnJheSBpcyBub3QgZW1wdHkgbG9vcCB0aHJvdWdoIGV2ZXJ5IHNlY29uZHNcbiAgICAgIC8vdGhlbiwgYWRkIGEgc3RlcFxuICAgICAgaWYgKGQubGVuZ3RoID4gMCAmJiBqIDw9IGQubGVuZ3RoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGQpO1xuICAgICAgICBhbmltID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmIChqID49IGQubGVuZ3RoICkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChhbmltKVxuICAgICAgICAgICAgLy9hZGQgb25lIHN0ZXBcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAvL3JldHVybiBhZGRPbmVTdGVwKCkgXG4gICAgICAgICAgICB9LCAxZTMpOy8vMXNcbiAgICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICByZW1vdmVBY3RpdmUoKVxuICAgICAgICAgICAgY29uc29sZS5sb2coZFtqXSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhR2FtZVtkW2pdXS5jb2xvcik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhR2FtZVtkW2pdXS5zb3VuZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAobGV0IHByb3AgaW4gZGF0YSl7XG4gICAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgICAgICAgbGV0IGRhID1kYXRhW3Byb3BdIFxuICAgICAgICAgICAgICAgIGlmIChwcm9wID09PSBkYXRhR2FtZVtkW2pdXS5jb2xvcikge1xuICAgICAgICAgICAgICAgICAgZGEuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vYWRkIHNvdW5kIHdpdGggcmFuZG9tVGVtcCBcbiAgICAgICAgICAgIF9wbGF5U291bmQoZGF0YUdhbWVbZFtqXV0uc291bmQpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhR2FtZVtkW2pdXS5zb3VuZCk7XG4gICAgICAgICAgICAvL2ZvciAobGV0IGkgPSAwLCBsID0gZC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgICAgLy9sZXQgY3VycmVudCA9IGRbaV1cbiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhjdXJyZW50KTtcbiAgICAgICAgICAgICAgLy9mb3IgKGxldCBwcm9wIGluIGRhdGFHYW1lKXtcbiAgICAgICAgICAgICAgICAvL2lmIChkYXRhR2FtZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkge1xuICAgICAgICAgICAgICAgICAgLy9pZiAoZGF0YUdhbWVbcHJvcF0ubnVtID09PSBjdXJyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coZGF0YUdhbWVbcHJvcF0uY29sb3IpO1xuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGFHYW1lW3Byb3BdLnNvdW5kKTtcbiAgICAgICAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy99XG4gICAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgLy99XG4gICAgICAgICAgfSBcbiAgICAgICAgICBqKytcbiAgICAgICAgfSwgMWUzKTsvLzFzXG4gICAgICB9XG4gICAgfSBcbiAgfVxuXG4gIC8vcmFuZG9tIGJldHdlZW4gMSBhbmQgNFxuICBsZXQgUmFuZG9tID0gKCkgPT4ge1xuICAgIHJhbmRvbSA9ICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KSArIDEgIFxuICAgIHJldHVybiByYW5kb20gXG4gIH1cblxuICBsZXQgcmVtb3ZlQWN0aXZlQ2xhc3MgPSAoKSA9PiB7XG4gICAgbGV0IGNvbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaGFwZV9fY29sb3InKVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb2xbaV0uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJylcbiAgICB9XG4gIH1cblxuICAvLyBwcml2YXRlXG4gIC8vIGRhdGFHYW1lID0gc291bmQsIG51bSwgY29sb3JcbiAgbGV0IF9zdGFydCA9ICgpID0+IHtcbiAgICBkYXRhLmNhc2VDb2NoZS5jaGVja2VkID0gZmFsc2VcbiAgICAvL2NoZWNrZWRcbiAgICBkYXRhLmNhc2VDb2NoZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLGZ1bmN0aW9uKCkge1xuICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLmNoZWNrZWQpO1xuICAgICAgaWYgKHRoaXMuY2hlY2tlZCkgey8vaWYgdGhpcy5jaGVja2VkIGlzIHRydWVcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH0gZWxzZXtcbiAgICAgICAgLy9lbXB0eSBhcnJheVNpbW9uIFxuICAgICAgICAvL2RhdGEuYXJyYXlTaW1vbiA9IFtdXG5cbiAgICAgICAgZGF0YS5zdGFydEFjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKVxuXG4gICAgICAgIC8vcmVtb3ZlIGNsYXNzIGVycm9yXG4gICAgICAgIGRhdGEuY291bnRCb3guY2xhc3NMaXN0LnJlbW92ZSgnZXJyb3InKVxuICAgICAgICBkYXRhLmNvdW50Qm94LnRleHRDb250ZW50ID0gJydcbiAgICAgICAgLy9yZW1vdmUgY2xhc3MgYWN0aXZlXG4gICAgICAgIHJlbW92ZUFjdGl2ZUNsYXNzKClcblxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfSBcblxuICAgIH0pO1xuICAgIGRhdGEuc3RhcnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoZGF0YS5jYXNlQ29jaGUuY2hlY2tlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAvL3N0YXJ0IHRoZSBhaVxuICAgICAgICBfYWkoKVxuICAgICAgICAvL3N0YXJ0IGJ0blxuICAgICAgICBkYXRhLnN0YXJ0QWN0aXZlLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpXG4gICAgICAgIC8vcmVtb3ZlIC5lcnJvclxuICAgICAgICBkYXRhLmNvdW50Qm94LmNsYXNzTGlzdC5yZW1vdmUoJ2Vycm9yJylcbiAgICAgIH0gLy9lbmQgY2hlY2tlZCB0cnVlXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7IC8vIGVuZCBjbGljayBvbiBzdGFydFxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgbGV0IHNoYXBlQ2xpY2sgPSAoKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSBkYXRhLnNoYXBlLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgbGV0IGN1cnJlbnQgPSBkYXRhLnNoYXBlW2ldLCBwcmV2ID0gZGF0YS5zaGFwZVtpLTFdO1xuICAgICAgY3VycmVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgbGV0ICR0aGlzID0gdGhpcy50ZXh0Q29udGVudFxuICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpXG4gICAgICAgIF9wbGF5U291bmQoZGF0YUdhbWVbJHRoaXNdLnNvdW5kKVxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9KTtcbiAgICB9XG5cblxuICB9XG5cbiAgbGV0IHJlbW92ZUFjdGl2ZSA9ICgpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IGRhdGEuc2hhcGUubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICBsZXQgY3VycmVudCA9IGRhdGEuc2hhcGVbaV0sIHByZXYgPSBkYXRhLnNoYXBlW2ktMV07XG4gICAgICBpZiAoY3VycmVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpID09PSB0cnVlKSB7XG4gICAgICAgIGN1cnJlbnQuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJylcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvL21haW5cbiAgbGV0IG1haW4gID0gKCkgPT4ge1xuXG4gICAgc2hhcGVDbGljaygpXG4gICAgX3N0YXJ0KClcbiAgICByZW1vdmVBY3RpdmUoKVxuICAgIHJldHVybiB0cnVlXG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBtYWluIDogbWFpblxuICB9O1xuXG59KSgpO1xuU2ltb24ubWFpbigpXG4vL1NpbW9uLmFub3RoZXJNZXRob2QgKClcbiJdfQ==
